# 🔒 Hướng dẫn kết nối H2 TCP Server từ máy cùng mạng LAN

## 🎯 Tổng quan
H2 TCP Server cho phép **CHỈ các máy trong cùng mạng LAN** kết nối đến database của ứng dụng BTMS qua TCP.

## 🛡️ Bảo mật
- ✅ Server chỉ bind to IP LAN cụ thể (không phải 0.0.0.0)
- ✅ Chỉ máy trong cùng mạng LAN có thể kết nối
- ✅ Không thể truy cập từ internet hoặc mạng khác
- ✅ Bảo vệ khỏi các kết nối không mong muốn từ bên ngoài

## ⚙️ Cấu hình Server (Máy chạy BTMS)

### 1. Khởi động H2 TCP Server
- H2 Server tự động khởi động khi chạy BTMS
- Server bind to **IP LAN cụ thể** trên port **9092**
- Remote access **CHỈ cho máy cùng mạng LAN** với `-tcpAllowOthers`

### 2. Mở port Firewall
```batch
# Chạy với quyền Administrator:
netsh advfirewall firewall add rule name="H2 TCP Server - BTMS" dir=in action=allow protocol=TCP localport=9092
```

Hoặc chạy file: `enable-h2-firewall.bat`

### 3. Kiểm tra IP máy server
```cmd
ipconfig | findstr "IPv4"
```
Ví dụ IP: `192.168.1.100`

## 🔌 Kết nối từ máy khác

### Connection String
```
jdbc:h2:tcp://[IP_SERVER]:9092/badminton_tournament
```

**Ví dụ cụ thể:**
```
jdbc:h2:tcp://192.168.1.100:9092/badminton_tournament
Username: sa  
Password: (để trống)
```

### Kết nối bằng H2 Console (Web)
1. Mở trình duyệt trên máy client
2. Truy cập: `http://localhost:8082` (nếu có H2 Console)
3. Nhập connection string ở trên

### Kết nối bằng công cụ DB khác
- **DBeaver**: New Connection → H2 → TCP
- **IntelliJ IDEA**: Database Tool → H2 → TCP  
- **Eclipse**: Data Source Explorer → H2

## ✅ Kiểm tra kết nối

### Từ máy Server (BTMS)
- Nhấp vào **H2: ✓ Port 9092** trên status bar
- Xem thông tin chi tiết về server và connection URLs

### Từ máy Client  
```bash
# Test kết nối bằng telnet
telnet [IP_SERVER] 9092
```

## 🚨 Xử lý sự cố

### 1. Không kết nối được
**Nguyên nhân phổ biến:**
- ❌ Firewall chặn port 9092
- ❌ Sử dụng sai IP (127.0.0.1 thay vì IP thực)
- ❌ H2 Server chưa khởi động
- ❌ Máy **KHÔNG CÙNG mạng LAN** (bị chặn bởi bảo mật)
- ❌ Máy client ở mạng con khác (VPN, subnet khác)

**Giải pháp:**
1. **Kiểm tra cùng mạng LAN:** Đảm bảo cả 2 máy cùng dải IP (vd: 192.168.1.x)
2. Chạy `enable-h2-firewall.bat` với quyền Admin
3. Dùng IP thực của máy server (không phải localhost)
4. Kiểm tra H2 status trên BTMS: **H2: ✓ Port 9092**
5. Ping test: `ping [IP_SERVER]`
6. Kiểm tra subnet mask: `ipconfig /all`

### 2. Connection timeout
- Kiểm tra network stability
- Thử kết nối từ máy khác cùng mạng
- Restart H2 Server (restart BTMS)

### 3. Database không tồn tại
- Database sẽ được tạo tự động khi kết nối lần đầu
- Đảm bảo thư mục `database/` có quyền ghi

## 📋 Thông tin kỹ thuật

| Thông số | Giá trị |
|----------|---------|
| **Port** | 9092 |
| **Bind Address** | LAN IP cụ thể (không phải 0.0.0.0) |
| **Network Access** | **CHỈ máy cùng mạng LAN** |
| **Database Path** | `./database/badminton_tournament` |
| **Username** | `sa` |
| **Password** | *(empty)* |
| **Allow Others** | ✅ Enabled (cùng LAN only) |
| **Auto-create DB** | ✅ Enabled |

## 🔐 Bảo mật

### ✅ Tính năng bảo mật đã được tích hợp:
- **LAN-only binding:** Server chỉ bind to IP LAN cụ thể, không phải 0.0.0.0
- **Network isolation:** Chỉ máy trong cùng subnet có thể kết nối
- **No internet exposure:** Không thể truy cập từ mạng external
- **Controlled access:** Ngăn chặn các kết nối không mong muốn

### Khuyến nghị bổ sung:
- Monitor connections thông qua BTMS status bar
- Cân nhắc đặt password cho user `sa` trong môi trường production
- Regular backup database files

### Trong môi trường production:
- Sử dụng database server chuyên dụng (SQL Server, PostgreSQL)
- Cấu hình SSL/TLS encryption
- Implement proper authentication & authorization

---
*Generated by BTMS H2 TCP Server Config*